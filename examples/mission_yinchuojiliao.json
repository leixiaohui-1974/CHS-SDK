{
    "description": "Full-scale simulation of the Yin Chuo Ji Liao Water Transfer Project.",
    "harness_config": { "duration": 168, "dt": 1.0 },
    "topics": {
        "intake_gate_cmd": "command/intake_gate_ctrl"
    },
    "components": [
        { "name": "wendegen_reservoir", "type": "Reservoir", "initial_state": {"water_level": 350.0}, "parameters": {"surface_area": 5e7}, "inflow_topic": "csv_inflow" },
        { "name": "water_intake_gate", "type": "Gate", "initial_state": {"opening": 0.5}, "parameters": {"width": 15, "discharge_coefficient": 0.6} },
        { "name": "tunnel_1", "type": "Canal", "initial_state": {"water_level": 349.0, "volume": 7e7}, "parameters": {"length": 70000, "bottom_width": 20, "slope": 0.0001, "side_slope_z": 2, "manning_n": 0.03} },
        { "name": "taoriver_gate", "type": "Gate", "initial_state": {"opening": 0.6}, "parameters": {} },
        { "name": "tunnel_2", "type": "Canal", "initial_state": {"water_level": 325.0, "volume": 8e6}, "parameters": {"length": 8000, "bottom_width": 20, "slope": 0.0001, "side_slope_z": 2, "manning_n": 0.03} },
        { "name": "guiliu_gate", "type": "Gate", "initial_state": {"opening": 0.6}, "parameters": {} },
        { "name": "tunnel_3", "type": "Canal", "initial_state": {"water_level": 322.0, "volume": 1e8}, "parameters": {"length": 100000, "bottom_width": 20, "slope": 0.0001, "side_slope_z": 2, "manning_n": 0.03} },
        { "name": "connection_pool", "type": "Reservoir", "initial_state": {"water_level": 320.0}, "parameters": {"surface_area": 1e4} },
        { "name": "pipe_1", "type": "Pipe", "initial_state": {"flow": 15.0, "pressure": 0.8}, "parameters": {"length": 20000, "diameter": 3.0, "friction_factor": 0.015} },
        { "name": "online_valve", "type": "Valve", "initial_state": {"setting": 0.7}, "parameters": {} },
        { "name": "pipe_2", "type": "Pipe", "initial_state": {"flow": 15.0, "pressure": 0.7}, "parameters": {"length": 80000, "diameter": 3.0, "friction_factor": 0.015} },
        { "name": "terminal_valve", "type": "Valve", "initial_state": {"setting": 0.5}, "parameters": {} },
        { "name": "terminal_pool", "type": "Reservoir", "initial_state": {"water_level": 212.0}, "parameters": {"surface_area": 1e5} }
    ],
    "connections": [
        ["wendegen_reservoir", "water_intake_gate"], ["water_intake_gate", "tunnel_1"], ["tunnel_1", "taoriver_gate"],
        ["taoriver_gate", "tunnel_2"], ["tunnel_2", "guiliu_gate"], ["guiliu_gate", "tunnel_3"],
        ["tunnel_3", "connection_pool"], ["connection_pool", "pipe_1"], ["pipe_1", "online_valve"],
        ["online_valve", "pipe_2"], ["pipe_2", "terminal_valve"], ["terminal_valve", "terminal_pool"]
    ],
    "controllers": [
        { "name": "pid_taoriver", "type": "PIDController", "parameters": {"Kp": -0.1, "Ki": -0.01, "Kd": -0.05, "setpoint": 324.20} },
        { "name": "pid_guiliu", "type": "PIDController", "parameters": {"Kp": -0.1, "Ki": -0.01, "Kd": -0.05, "setpoint": 320.38} },
        { "name": "pid_online_valve", "type": "PIDController", "parameters": {"Kp": 0.2, "Ki": 0.02, "Kd": 0.1, "setpoint": 0.65} },
        { "name": "pid_terminal_valve", "type": "PIDController", "parameters": {"Kp": -0.05, "Ki": -0.005, "Kd": -0.02, "setpoint": 212.5} },
        { "name": "pid_intake_gate", "type": "PIDController", "parameters": {"Kp": -0.1, "Ki": -0.01, "Kd": -0.05, "setpoint": 349.5} }
    ],
    "agents": [
        { "name": "csv_inflow", "type": "CsvInflowAgent", "component": "wendegen_reservoir", "csv_path": "data/historical_inflow.csv", "time_col": "time", "data_col": "inflow" },

        { "name": "emergency_agent", "type": "EmergencyAgent", "listen_topics": ["state/pipe_1/pressure", "state/pipe_2/pressure"], "pressure_threshold": 0.3, "command_topic": "intake_gate_cmd" },
        { "name": "central_dispatcher", "type": "CentralDispatcherAgent", "listen_topic": "state/terminal_pool/water_level", "command_topic": "intake_gate_cmd", "config": {"low_level": 212.0, "high_level": 213.0, "low_setpoint": 349.8, "high_setpoint": 349.2} },

        { "name": "pid_ctrl_intake", "type": "LocalControlAgent", "controller": "pid_intake_gate", "observation_topic": "state/tunnel_1/water_level", "action_topic": "action/water_intake_gate/opening", "command_topic": "intake_gate_cmd"},
        { "name": "io_intake", "type": "PhysicalIOAgent", "sensors_config": {"s1": {"component":"tunnel_1", "state_key":"water_level", "topic":"state/tunnel_1/water_level"}}, "actuators_config": {"a1": {"component":"water_intake_gate", "target_attr":"target_opening", "topic":"action/water_intake_gate/opening", "control_key":"control_signal"}} },

        { "name": "pid_ctrl_taoriver", "type": "LocalControlAgent", "controller": "pid_taoriver", "observation_topic": "state/tunnel_1/water_level", "action_topic": "action/taoriver_gate/opening"},
        { "name": "io_taoriver", "type": "PhysicalIOAgent", "sensors_config": {"s1": {"component":"tunnel_1", "state_key":"water_level", "topic":"state/tunnel_1/water_level"}}, "actuators_config": {"a1": {"component":"taoriver_gate", "target_attr":"target_opening", "topic":"action/taoriver_gate/opening", "control_key":"control_signal"}} }
    ],
    "scenario": { "events": [ { "time": 100, "type": "set_state", "target": "pipe_1", "state": {"pressure": 0.1} } ] }
}
