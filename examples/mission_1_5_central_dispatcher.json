{
    "description": "Mission 1.5: Central MPC Dispatcher. Demonstrates how the CentralMPCAgent uses a forecast to issue a new, optimized setpoint.",
    "simulation_settings": {
        "dt": 1.0,
        "duration": 2
    },
    "topics": {
        "state_topic_upstream": "state/canal_upstream/level",
        "state_topic_downstream": "state/canal_downstream/level",
        "forecast_topic": "forecast/inflow",
        "command_topic_upstream": "command/gate_upstream/setpoint",
        "command_topic_downstream": "command/gate_downstream/setpoint"
    },
    "agents": [
        {
            "name": "central_dispatcher_1",
            "type": "CentralMPCAgent",
            "dt": 3600,
            "prediction_horizon": 10,
            "q_weight": 1.0,
            "r_weight": 0.5,
            "state_keys": ["upstream", "downstream"],
            "state_subscriptions": {
                "upstream": "state_topic_upstream",
                "downstream": "state_topic_downstream"
            },
            "forecast_subscription": "forecast_topic",
            "command_topics": {
                "upstream_cmd": "command_topic_upstream",
                "downstream_cmd": "command_topic_downstream"
            },
            "normal_setpoints": [10.0, 8.0],
            "emergency_setpoint": 8.5,
            "flood_thresholds": [12.0, 10.0],
            "canal_surface_areas": [1.5e6, 1.5e6],
            "outflow_coefficient": 1000
        }
    ],
    "scenario": {
        "events": [
            {
                "time": 0, "type": "publish_command",
                "topic": "state_topic_upstream", "payload": { "water_level": 10.1 }
            },
            {
                "time": 0, "type": "publish_command",
                "topic": "state_topic_downstream", "payload": { "water_level": 8.0 }
            },
            {
                "time": 0, "type": "publish_command",
                "topic": "forecast_topic", "payload": { "inflow_forecast": [50.0, 50.0, 50.0, 50.0, 50.0, 50.0, 50.0, 50.0, 50.0, 50.0] }
            }
        ]
    },
    "verification": {
        "type": "check_command_value",
        "listener_topic": "command_topic_upstream",
        "payload_key": "new_setpoint",
        "condition": "less_than",
        "value": 10.0
    }
}
