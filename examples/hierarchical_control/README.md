# 示例: 分层分布式控制 (Hierarchical Control)

## 业务场景

本示例模拟了一个复杂的水利调度场景，旨在检验系统的分层控制能力和对预报洪水的响应能力。

场景包含一个上游渠池和一个下游渠池，由一个闸门连接。系统面临以下挑战：
1.  **持续的基准入流**: 模拟上游来水。
2.  **可预报的洪水**: 在仿真进行到一半时，一个巨大的洪水波（通过`RainfallAgent`模拟）将到达上游渠池。此事件是**已知**的，并通过`InflowForecasterAgent`提前告知系统。
3.  **无预报的用水**: 在洪水期间，下游的一个用水户（通过`WaterUseAgent`模拟）突然开始大量取水，这是一个**未知**的扰动。

## 控制策略

系统采用两级分层控制架构来应对这一挑战：

1.  **高层决策 (中央MPC调度智能体)**:
    - `CentralMPCAgent` 接收到未来的洪水预报。
    - 它通过模型预测控制（MPC）算法进行优化计算，得出一个结论：为了给即将到来的洪水预留库容，必须**主动、提前**降低上游渠池的控制水位。
    - 它向下层的PID控制器发送一个新的、更低的目标水位设定点（Setpoint）。

2.  **低层执行 (本地PID控制智能体)**:
    - `LocalControlAgent` (配置了`PIDController`) 接收来自上层调度器的新设定点。
    - 它的任务是精确地执行该指令，通过控制闸门的开度，将上游渠池的水位稳定在新的、更低的目标上。

## 如何运行

你可以通过运行此目录下的 `run.py` 脚本来启动此示例。
```bash
python3 run.py
```
该脚本会自动调用顶层的通用运行器，并使用本目录下的配置文件 (`sim_config.json`, `disturbances.json`)。

## 预期结果

仿真结束后，你会在 `output/` 子目录中看到 `history.csv` 和 `hierarchical_control_results.png`。

观察 `hierarchical_control_results.png` 图表，你应该能看到：
- 在洪水来临之前，上游水位已经开始下降，这是因为中央调度器下达了预泄指令。
- 尽管有巨大的洪水入流，但由于提前预泄，最高水位被成功地控制在洪水阈值（6.5米）以下。
- 这证明了分层控制系统在应对复杂、可预报事件中的有效性和前瞻性。
