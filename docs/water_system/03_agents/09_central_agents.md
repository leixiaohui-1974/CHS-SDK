# 核心智能体: 中央协调智能体

本篇文档介绍一系列用于实现系统级、全局性协调与决策的中央智能体。这些智能体位于控制层级的顶端，负责监控整个系统的状态并下发宏观指令。

---

## 1. `CentralPerceptionAgent` (中央感知智能体)

*   **源代码**: `core_lib/central_coordination/perception/central_perception_agent.py`

### 概述

`CentralPerceptionAgent` 扮演着多智能体系统（MAS）的“感觉中枢”或“态势中心”的角色。它的核心职责是**汇集**信息，而不是产生信息。

### 工作机制

1.  **订阅多个主题**: 在初始化时，该智能体需要配置一个包含多个“组件ID”到“状态主题”映射的字典。它会订阅所有这些由底层的、分布式的感知智能体（如 `ReservoirPerceptionAgent`, `PumpStationPerceptionAgent` 等）发布的状态主题。
2.  **构建全局状态**: 当任何一个被订阅的主题上有新的状态消息到达时，`CentralPerceptionAgent` 会用该消息更新其内部维护的一个“全局状态”字典。这个字典以组件ID为键，保存了每个组件的最新状态。
3.  **发布全局状态**: 在 `run()` 方法被调用时（即每个仿真步长），它会将这个包含了所有组件最新状态的、完整的全局状态字典，发布到一个统一的“全局状态主题” (`global_state_topic`) 上。

这个智能体为系统中的其他中央决策者（如调度员、优化算法或数字孪生可视化平台）提供了一个单一、全面的数据来源。

---

## 2. `CentralDispatcherAgent` (中央调度智能体)

在当前代码库中，存在两个都名为 `CentralDispatcherAgent` 的类，但它们位于不同路径下，且职责有所不同。这代表了两种不同类型的中央调度逻辑。

### 版本 A: 应急响应调度

*   **源代码**: `core_lib/central_coordination/dispatch/central_dispatcher_agent.py`

#### 概述

这个版本的调度器是一个**高优先级、以安全为核心的应急响应智能体**。它的主要任务是监控关键系统状态，并在发生或即将发生紧急情况时，**直接干预**，发布覆盖性的控制指令，以确保系统的安全。

#### 工作机制

-   **直接访问物理模型**: 与大多数通过消息总线解耦的智能体不同，该智能体在初始化时会直接获取一个关键物理对象（如一个重要的水库 `Reservoir`）的实例。
-   **紧急状态检查**: 在 `run()` 方法中，它会直接调用物理对象的 `get_state()` 方法来检查关键指标（如水位）。
-   **发布覆盖指令**: 如果发现指标超过了预设的紧急阈值（如 `emergency_flood_level`），它会立即向一个或多个执行器（如一个下游的供水闸门）的动作主题发布一个**强制性**的控制指令（如“立刻关闭闸门”），这个指令会覆盖掉由常规控制智能体发出的指令。

---

### 版本 B: 规则化 supervisory 控制

*   **源代码**: `core_lib/local_agents/supervisory/central_dispatcher_agent.py`

#### 概述

这个版本的调度器是一个**基于规则的、 supervisory 级别的控制器**。它通过调整远程控制器的设定点（Setpoint）来实现对系统某个宏观指标的间接管理。

#### 工作机制

-   **订阅观测值**: 该智能体订阅一个它关心的状态主题（如某个末端水库的水位），从中获取当前的观测值。
-   **应用规则**: 其核心逻辑是一种简单的**滞回控制**（或称“bang-bang”控制）。`dispatcher_params` 中定义了高、低两个水位阈值，以及分别对应的两种控制策略（高、低两种设定点）。
    -   如果当前水位低于 `low_level`，它会向远程控制器发布 `high_setpoint`，意图增加来水。
    -   如果当前水位高于 `high_level`，它会向远程控制器发布 `low_setpoint`，意图减少来水。
-   **发布设定点**: 它将计算出的新设定点 `new_setpoint` 发布到一个 `command_topic` 上，由下游的某个 `LocalControlAgent` 接收并执行。

这个智能体是实现一些简单、鲁棒的全局水量平衡或库存管理策略的有效工具。
