# 核心智能体: 数据输入智能体

本篇文档介绍用于从外部数据文件（特指CSV文件）读取时间序列数据，并将其作为输入注入到仿真系统中的一系列智能体。这些智能体是实现“数据驱动”仿真的关键。

---

## 1. `CsvReaderAgent` (通用CSV读取器)

*   **源代码**: `core_lib/disturbances/csv_reader_agent.py`

### 概述

`CsvReaderAgent` 是一个**通用**的CSV数据读取和发布工具。它的职责非常纯粹：在仿真的特定时间点，从CSV文件中读取一个值，并将其发布到一个指定的主题上。

### 工作机制

1.  **初始化**:
    -   `filepath`: CSV文件的路径。
    -   `time_col`: 文件中用作时间索引的列名。
    -   `data_col`: 文件中包含需要发布的数据的列名。
    -   `topic`: 用于发布数据的消息总线主题。
2.  **执行**: 在 `run()` 方法中，它会检查当前的仿真时间 `current_time` 是否在CSV文件的时间索引中。
3.  **发布**: 如果时间匹配，它会读取对应行 `data_col` 的值，并将其封装在一个消息体中 `{'value': data_value, 'time': current_time}`，然后发布到指定的 `topic`。

这个智能体非常灵活，可以用于模拟任何类型的时间序列数据输入，例如模拟一个外部传感器的数据流、某个区域的历史用水量、或者一个天气API的天气预报数据等。

---

## 2. `CsvInflowAgent` (CSV入流智能体)

*   **源代码**: `core_lib/data_access/csv_inflow_agent.py`

### 概述

`CsvInflowAgent` 是 `CsvReaderAgent` 的一个**专一化版本**，其设计目标非常明确：为系统中的某个物理组件（如水库、渠池）提供**历史入流**数据。

### 与 `CsvReaderAgent` 的异同

**相同点**:
-   都从CSV文件读取时间序列数据。
-   都在匹配的仿真时间点发布数据。

**不同点**:
-   **意图更明确**: 它的命名和参数（如 `target_component`）都清晰地表明其用途是提供“入流”。
-   **主题构造**: 如果不显式提供 `inflow_topic`，它会根据 `target_component` 的名称自动构造一个主题，如 `inflow/my_reservoir`。这有助于维持系统消息主题的规范性。
-   **消息格式**: 它发布的消息格式是固定的 `{'inflow_rate': float(inflow_value)}`。这使得需要订阅入流数据的物理组件（如 `Canal`）可以依赖一个统一的消息接口。
-   **时间处理**: `CsvInflowAgent` 的时间匹配逻辑更灵活，它会查找小于或等于当前仿真时间的最接近的数据点，这使得它能更好地处理仿真步长与数据时间粒度不一致的情况。而 `CsvReaderAgent` 要求时间完全精确匹配。

### 总结

-   当您需要一个通用的、能发布任何类型数据的CSV读取器时，请使用 **`CsvReaderAgent`**。
-   当您的目标是为某个组件提供有物理意义的“入流”数据时，使用 **`CsvInflowAgent`** 是更好的选择，因为它提供了更规范的接口和更强的语义。
