# 5. 模型评价 (Evaluation)

本篇文档详细介绍 `core_lib` 中用于模型评价的功能。

## 1. 核心理念：量化的模型性能度量

在水务系统中，任何仿真或预测模型（统称为“模型”）的输出都需要与真实世界的观测数据进行比较，以评估其准确性和可靠性。`core_lib` 提供了一个专门的模块来实现这种量化的性能度量。

与系统中其他基于“智能体(Agent)”的模块不同，评价功能目前在 `core_lib` 中是以一个**工具库（Utility Library）**的形式存在的。

## 2. `evaluator.py` 模块详解

*   **位置**: `core_lib/data_processing/evaluator.py`
*   **职责**: 提供一套标准的、可重用的函数，用于计算模型输出（模拟值）与真实数据（观测值）之间的统计误差或效率指标。

该模块提供了以下三个核心函数：

### 2.1 `calculate_rmse(simulated, observed)`

*   **指标**: **均方根误差 (Root Mean Squared Error, RMSE)**
*   **解释**: 这是最常用的误差度量之一。它计算了模拟值与观测值之差的平方的平均值的平方根。RMSE的值越小，表示模型的预测误差越小，精度越高。它的单位与原始数据相同，因此易于理解。
*   **用途**: 用于衡量模型预测的平均误差大小。

### 2.2 `calculate_nse(simulated, observed)`

*   **指标**: **纳什效率系数 (Nash-Sutcliffe Efficiency, NSE)**
*   **解释**: 这是水文模型评价中应用最广泛的指标。它的取值范围为负无穷到1。
    *   **NSE = 1**: 表示模型完美匹配观测数据。
    *   **NSE = 0**: 表示模型的预测能力与使用观测数据的“平均值”作为预测是相同的水平。这是一个基准。
    *   **NSE < 0**: 表示模型的预测结果还不如直接使用观测数据的平均值，说明模型很差。
*   **用途**: 用于评估水文模型的整体拟合优度，是行业内的黄金标准之一。

### 2.3 `calculate_kge(simulated, observed)`

*   **指标**: **克林-古普塔效率系数 (Kling-Gupta Efficiency, KGE)**
*   **解释**: KGE 是对 NSE 的一种改进，它将模型的误差分解为三个独立的部分：
    1.  **相关性 (Correlation)**: 模拟值与观测值的变化趋势是否一致。
    2.  **偏差 (Bias)**: 模拟值的平均水平是否系统性地高于或低于观测值。
    3.  **变异性 (Variability)**: 模拟值的离散程度（标准差）是否与观测值相当。
    KGE 的理想值也是1。它比 NSE 提供了更丰富的诊断信息，可以帮助分析模型在哪个方面存在不足。
*   **用途**: 用于对模型进行更深入的诊断性评估。

## 3. 在系统中的应用

虽然 `core_lib` 中没有一个名为 `EvaluationAgent` 的现成智能体，但 `evaluator.py` 中的函数可以被任何其他智能体或外部脚本调用，以执行评价任务。

一个典型的应用场景是：
1.  一个脚本定期从数据库中提取某个模型的历史模拟结果和对应的真实观测数据。
2.  调用 `evaluator.py` 中的函数（如 `calculate_nse`）来计算该模型在过去一段时间的性能得分。
3.  将计算出的得分存储起来，形成模型的“健康度”时间序列，用于长期跟踪模型的性能变化。
4.  如果性能得分低于某个阈值，可以自动触发告警，通知模型开发者需要对模型进行重新校准或改进。
